{% extends "base/base.html" %}

{% block title %}Create Character{% endblock %}
{% block content_header %}Create New Character{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="card card-primary">
        <div class="card-header">
            <h3 class="card-title">Character Details</h3>
        </div>
        <form id="createCharacterForm">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="characterId">ID</label>
                            <input type="text" class="form-control" id="characterId" name="id" placeholder="Enter unique ID (e.g., character_name_01)" required>
                        </div>
                        <div class="form-group">
                            <label for="characterName">Name</label>
                            <input type="text" class="form-control" id="characterName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="characterRace">Race</label>
                            <input type="text" class="form-control" id="characterRace" name="race">
                        </div>
                        <div class="form-group">
                            <label for="characterSkinColor">Skin Color</label>
                            <input type="text" class="form-control" id="characterSkinColor" name="skin_color">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>Head Attributes</h5>
                        <div class="form-group">
                            <label for="hairColor">Hair Color</label>
                            <input type="text" class="form-control" id="hairColor" name="hair_color">
                        </div>
                        <div class="form-group">
                            <label for="hairStyle">Hair Style</label>
                            <input type="text" class="form-control" id="hairStyle" name="hair_style">
                        </div>
                        <div class="form-group">
                            <label for="hairLength">Hair Length</label>
                            <input type="text" class="form-control" id="hairLength" name="hair_length">
                        </div>
                        <div class="form-group">
                            <label for="faceType">Face Type</label>
                            <input type="text" class="form-control" id="faceType" name="face_type">
                        </div>
                        <div class="form-group">
                            <label for="eyeColor">Eye Color</label>
                            <input type="text" class="form-control" id="eyeColor" name="eye_color">
                        </div>
                        <div class="form-group">
                            <label for="makeupType">Makeup Type</label>
                            <input type="text" class="form-control" id="makeupType" name="makeup_type">
                        </div>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-6">
                        <h5>Body Attributes</h5>
                        <div class="form-group">
                            <label for="bodyType">Body Type</label>
                            <input type="text" class="form-control" id="bodyType" name="body_type">
                            <ul>
                                <li><small class="form-text text-muted">athletic body</small></li>
                                <li><small class="form-text text-muted">curvy body</small></li>
                                <li><small class="form-text text-muted">thick body</small></li>
                                <li><small class="form-text text-muted">petite body, thin, skinny, athletic, short</small></li>
                                <li><small class="form-text text-muted">tall, skinny</small></li>
                            </ul>
                        </div>
                        <div class="form-group">
                            <label for="breastsType">Breasts Type</label>
                            <input type="text" class="form-control" id="breastsType" name="breasts_type">
                            <ul>
                                <li><small class="form-text text-muted">natural breasts</small></li>
                                <li><small class="form-text text-muted">perky breasts, pointy breasts</small></li>
                                <li><small class="form-text text-muted">teardrop breasts</small></li>
                                <li><small class="form-text text-muted">teardrop breasts, perky breasts</small></li>
                            </ul>
                        </div>
                        <div class="form-group">
                            <label for="breastsSize">Breasts Size</label>
                            <input type="text" class="form-control" id="breastsSize" name="breasts_size">
                            <ul>
                                <li><small class="form-text text-muted">flat chest</small></li>
                                <li><small class="form-text text-muted">small breasts</small></li>
                                <li><small class="form-text text-muted">medium breasts</small></li>
                                <li><small class="form-text text-muted">large breasts</small></li>
                            </ul>
                        </div>
                        <div class="form-group">
                            <label for="nipplesType">Nipples Type</label>
                            <input type="text" class="form-control" id="nipplesType" name="nipples_type">
                            <ul>
                                <li><small class="form-text text-muted">dark nipples</small></li>
                                <li><small class="form-text text-muted">light nipples</small></li>
                                <li><small class="form-text text-muted">pink nipples</small></li>
                                <li><small class="form-text text-muted">small nipples</small></li>
                                <li><small class="form-text text-muted">large nipples</small></li>
                                <li><small class="form-text text-muted">puffy nipples</small></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5>Other Physical Attributes</h5>
                        <div class="form-group">
                            <label for="handsType">Hands Type</label>
                            <input type="text" class="form-control" id="handsType" name="hands_type">
                        </div>
                        <div class="form-group">
                            <label for="hipsType">Hips Type</label>
                            <input type="text" class="form-control" id="hipsType" name="hips_type">
                            <ul>
                                <li><small class="form-text text-muted">small hips, thin hips</small></li>
                                <li><small class="form-text text-muted">thick thighs, thin waist</small></li>
                                <li><small class="form-text text-muted">wide hips, thick thighs, thin waist</small></li>
                                <li><small class="form-text text-muted">wide hips, wide thighs</small></li>
                                <li><small class="form-text text-muted">thin hips</small></li>
                            </ul>
                        </div>
                        <div class="form-group">
                            <label for="assType">Ass Type</label>
                            <input type="text" class="form-control" id="assType" name="ass_type">
                            <ul>
                                <li><small class="form-text text-muted">perfect ass, thick ass, bubble butt</small></li>
                                <li><small class="form-text text-muted">perfect ass, tight ass, bubble butt, small ass</small></li>
                                <li><small class="form-text text-muted">thick ass, pawg, big ass</small></li>
                            </ul>
                        </div>
                        <div class="form-group">
                            <label for="pussyType">Pussy Type</label>
                            <input type="text" class="form-control" id="pussyType" name="pussy_type">
                            <ul>
                                <li><small class="form-text text-muted">perfect pussy</small></li>
                                <li><small class="form-text text-muted">perfect pussy, labia</small></li>
                                <li><small class="form-text text-muted">innie pussy, perfect pussy, tight pussy, puffy pussy, mons pubis</small></li>
                                <li><small class="form-text text-muted">pussy, large labia, clit, clitoris</small></li>
                            </ul>
                        </div>
                        <div class="form-group">
                            <label for="legsType">Legs Type</label>
                            <input type="text" class="form-control" id="legsType" name="legs_type">
                        </div>
                        <div class="form-group">
                            <label for="feetType">Feet Type</label>
                            <input type="text" class="form-control" id="feetType" name="feet_type">
                        </div>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-md-12">
                        <h5>Clothing Attributes</h5>
                        <div class="form-group">
                            <label for="clothingHead">Clothing - Head</label>
                            <input type="text" class="form-control" id="clothingHead" name="clothing_head">
                        </div>
                        <div class="form-group">
                            <label for="clothingUpperBody">Clothing - Upper Body</label>
                            <input type="text" class="form-control" id="clothingUpperBody" name="clothing_upper_body">
                        </div>
                        <div class="form-group">
                            <label for="clothingLowerBody">Clothing - Lower Body</label>
                            <input type="text" class="form-control" id="clothingLowerBody" name="clothing_lower_body">
                        </div>
                        <div class="form-group">
                            <label for="clothingFeet">Clothing - Feet</label>
                            <input type="text" class="form-control" id="clothingFeet" name="clothing_feet">
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <button type="submit" class="btn btn-primary">Submit</button>
                <a href="{{ url_for('list_characters_page') }}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block js_scripts %}
<script type="module">
    import { initializeApi, apiCrud, uiHelpers } from '/static/js/api_utils.js';

    {% if tokens and tokens.access_token and tokens.refresh_token %}
    initializeApi({
        access_token: "{{ tokens.access_token }}",
        refresh_token: "{{ tokens.refresh_token }}"
    });
    {% else %}
    console.warn('API tokens not found in template context. API calls might fail if authentication is required.');
    initializeApi({});
    {% endif %}

    const form = document.getElementById('createCharacterForm');
    if (form) {
        form.addEventListener('submit', async function(event) {
            event.preventDefault();
            try {
                const formData = uiHelpers.getFormData('createCharacterForm');
                // Filter out empty string values to send them as null or not at all
                const processedFormData = {};
                for (const key in formData) {
                    if (formData[key] !== "") {
                        processedFormData[key] = formData[key];
                    }
                }

                await apiCrud.create('characters', processedFormData);
                uiHelpers.showToast('Character created successfully!', 'success');
                setTimeout(() => {
                    window.location.href = "{{ url_for('view_character_page', character_id=character_id) }}";
                }, 1500);
            } catch (error) {
                console.error('Failed to create Character:', error);
                uiHelpers.showError(error.responseJSON?.detail || error.message || 'Failed to create Character. Please check console for details.');
            }
        });
    }
</script>
{% endblock %} 
