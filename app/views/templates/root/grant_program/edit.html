{% extends "base/base.html" %}

{% block title %}{{ "Edit" if grant_program else "New" }} Grant Program{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title mb-0">{{ "Edit" if grant_program else "New" }} Grant Program</h2>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ '/grant-programs/' + grant_program.id|string + '/edit' if grant_program else '/grant-programs/new' }}">
                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="name" name="name" 
                                value="{{ grant_program.name if grant_program else '' }}" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3" 
                                >{{ grant_program.description if grant_program else '' }}</textarea>
                        </div>

                        <div class="mb-3">
                            <label for="url" class="form-label">Website URL</label>
                            <input type="url" class="form-control" id="url" name="url" 
                                   value="{{ grant_program.url if grant_program else '' }}"
                                   placeholder="https://example.com">
                        </div>

                        <!-- Add funding range fields -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="funding_range_min" class="form-label">Minimum Funding ($)</label>
                                    <input type="number" class="form-control" id="funding_range_min" name="funding_range_min" 
                                           value="{{ grant_program.funding_range_min if grant_program else '0' }}"
                                           min="0" step="1">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="funding_range_max" class="form-label">Maximum Funding ($)</label>
                                    <input type="number" class="form-control" id="funding_range_max" name="funding_range_max" 
                                           value="{{ grant_program.funding_range_max if grant_program else '0' }}"
                                           min="0" step="1">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="organization_id" class="form-label">Organization</label>
                            <select class="form-select" id="organization_id" name="organization_id" required>
                                <option value="">Select Organization</option>
                                {% for org in organizations %}
                                <option value="{{ org.id }}" 
                                    {{ 'selected' if (grant_program and grant_program.organization_id == org.id) or 
                                        (not grant_program and selected_organization_id == org.id) else '' }}>
                                    {{ org.name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="frequency" class="form-label">Frequency</label>
                            <select class="form-select" id="frequency" name="frequency" required>
                                {% for freq in program_frequencies %}
                                <option value="{{ freq }}" 
                                    {{ 'selected' if grant_program and grant_program.frequency == freq else '' }}>
                                    {{ freq }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="status" class="form-label">Status</label>
                            <select class="form-select" id="status" name="status" required>
                                {% for status in program_statuses %}
                                <option value="{{ status }}"
                                    {{ 'selected' if grant_program and grant_program.status == status else '' }}>
                                    {{ status }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Settings -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Settings</h5>
                            </div>
                            <div class="card-body">
                                <div class="form-check mb-2">
                                    <input type="checkbox" class="form-check-input" id="requires_loi" name="requires_loi"
                                           {{ 'checked' if grant_program and grant_program.requires_loi else '' }}>
                                    <label class="form-check-label" for="requires_loi">
                                        Requires Letter of Intent (LOI)
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Funding Exclusions -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Funding Exclusions</h5>
                            </div>
                            <div class="card-body">
                                <div class="form-check mb-2">
                                    <input type="checkbox" class="form-check-input" id="excludes_operating_expenses" 
                                           name="excludes_operating_expenses"
                                           {{ 'checked' if grant_program and grant_program.excludes_operating_expenses else '' }}>
                                    <label class="form-check-label" for="excludes_operating_expenses">
                                        Operating Expenses
                                        <small class="text-muted d-block">General costs required to run the organization</small>
                                    </label>
                                </div>

                                <div class="form-check mb-2">
                                    <input type="checkbox" class="form-check-input" id="excludes_salaries" 
                                           name="excludes_salaries"
                                           {{ 'checked' if grant_program and grant_program.excludes_salaries else '' }}>
                                    <label class="form-check-label" for="excludes_salaries">
                                        Salaries
                                        <small class="text-muted d-block">Employee wages and compensation</small>
                                    </label>
                                </div>

                                <div class="form-check mb-2">
                                    <input type="checkbox" class="form-check-input" id="excludes_administrative_overhead" 
                                           name="excludes_administrative_overhead"
                                           {{ 'checked' if grant_program and grant_program.excludes_administrative_overhead else '' }}>
                                    <label class="form-check-label" for="excludes_administrative_overhead">
                                        Administrative Overhead
                                        <small class="text-muted d-block">Administrative costs not directly tied to a project</small>
                                    </label>
                                </div>

                                <div class="form-check mb-2">
                                    <input type="checkbox" class="form-check-input" id="excludes_capital_expenditures" 
                                           name="excludes_capital_expenditures"
                                           {{ 'checked' if grant_program and grant_program.excludes_capital_expenditures else '' }}>
                                    <label class="form-check-label" for="excludes_capital_expenditures">
                                        Capital Expenditures
                                        <small class="text-muted d-block">Purchase of property, equipment, or infrastructure</small>
                                    </label>
                                </div>

                                <div class="form-check mb-2">
                                    <input type="checkbox" class="form-check-input" id="excludes_debt_service" 
                                           name="excludes_debt_service"
                                           {{ 'checked' if grant_program and grant_program.excludes_debt_service else '' }}>
                                    <label class="form-check-label" for="excludes_debt_service">
                                        Debt Service
                                        <small class="text-muted d-block">Repayment of loans, including interest and principal</small>
                                    </label>
                                </div>

                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="excludes_fundraising_expenses" 
                                           name="excludes_fundraising_expenses"
                                           {{ 'checked' if grant_program and grant_program.excludes_fundraising_expenses else '' }}>
                                    <label class="form-check-label" for="excludes_fundraising_expenses">
                                        Fundraising Expenses
                                        <small class="text-muted d-block">Costs related to raising money or donor engagement</small>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ '/grant-programs/' + grant_program.id|string if grant_program else '/grant-programs' }}" 
                                class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">Save</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} 
